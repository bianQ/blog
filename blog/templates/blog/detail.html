<!DOCTYPE html>
{% load static %}
<html>
	{% include '_head.html' %}
	<body id="single">
		{% include '_navigation.html' %}
		<div class="content-body">
			<div class="container">
				<div class="row">
					<main class="col-md-8">
						<article class="post post-1">
							<header class="entry-header">
								<h1 class="article-title">{{ article.title }}</h1>
								<div class="article-meta">
									{% if article.category %}
									<span class="post-category"><a href="{% url 'category' article.category.id %}">{{ article.category.name }}</a></span>
									{% endif %}
									<span class="post-date"><a><time class="entry-date">{{ article.created_time|date:"Y年n月d日" }}</time></a></span>
									<span class="post-author"><a href="{% url 'author' article.author %}">{{ article.author }}</a></span>
									<span class="views-count"><a>阅读{{ article.views }}</a></span>
									<span class="comments-link"><a href="#comment-list">评论{{ comment_list|length }}</a></span>
									<span class="likes-count"><a>喜欢{{ article.likes }}</a></span>
								</div>
								<div class="article-meta widget-tag-cloud">
									<ul>
										{% for tag in article_tags %}
											<li class="comments-link"><a href="{% url 'tag' tag.id %}">{{ tag.name }}</a></li>
										{% endfor %}
									</ul>
								</div>
							</header>
							<br>
							<br>
							<div class="entry-content clearfix">
								{{ article.mk_body | safe }}
							</div>
						</article>

						<div class="post"><hr>
							<button id="agree" type="button" class="btn btn-default"><span class="ion-android-favorite-outline"> 喜欢 {{ article.likes }}</span></button>
							<button type="button" class="btn btn-default">分享</button>
						</div>
						<section class="post comment-area" id="comment-area">
							<br>
							<h4>发表评论</h4>
							<br>
							<form action="{% url 'comment' article.pk %}" method="post" class="form-horizontal comment-form">
								{% csrf_token %}
								<div class="form-group">
									<label for="id_name" class="col-sm-2 control-label">名字：</label>
									<div class="col-md-4">
										{{ form.user_name }}
										{% if form_errors.user_name %}
										{{ form_errors.user_name }}
										{% endif %}
									</div>
									<label for="id_email" class="col-sm-2 control-label">邮箱：</label>
									<div class="col-md-4">
										{{ form.user_email }}
										{% if form_errors.user_email %}
										{{ form_errors.user_email |safe }}
										{% endif %}
									</div>
								</div>
								<div class="form-group">
									<label for="id_text" class="col-sm-2 control-label">评论：</label>
									<div class="col-md-10">
										{{ form.body }}
									</div>
								</div>
								<div class="form-group">
									<div class="col-sm-offset-2 col-sm-10">
      									<button type="submit" class="btn btn-default">提交</button>
									</div>
								</div>
							</form>
							<div class="comment-list-title">评论列表，共 <span>{{ comment_list|length }}</span> 条评论</div>
							<div class="comment-list-panel post">
								<ul class="comment-list list-unstyled" id="comment-list">
									{% for comment in comment_list %}
									<li class="comment-item">
										<span class="nickname">{{ comment.user_name }}</span>
										<time class="submit-date">{{ comment.created_time |date:"Y年n月d日 H:m"}}</time>
										<span class="comment">回复</span>
										<div class="text">{{ comment.body }}</div>
										<section>
											<header class="answer_reply_title">--- 共有 0 条评论 ---</header>
											<blockquote class="answer_replies">
												<div>
													<span class="nickname">{{ comment.user_name }}</span>
													<time class="submit-date">{{ comment.created_time |date:"Y年n月d日 H:m"}}</time>
													<div class="text">{{ comment.body }}</div>
												</div>
											</blockquote>
										</section>
									</li>
									{% endfor %}
								</ul>
							</div>
						</section>
					</main>
					{% include '_sidebar.html' %}
				</div>
			</div>
		</div>
		{% include '_footer.html' %}

		{% include '_Mobile_Menu.html' %}

		<script src="{% static 'blog/js/script.js' %}"></script>
		<script>
			$('#agree').click(function(){
				var url = "{% url 'agree' article.pk %}";
				var that = $(this);
				if ($(this).children('span').attr('class')==='ion-android-favorite-outline'){
					$(this).children('span').attr('class', 'ion-android-favorite');
					$.getJSON(url, {
						'agree': '1',
						'csrfmiddlewaretoken': '{{ csrf_token }}'
					}).done(function (data) {
						that.children('span').text(' 喜欢 ' + data);
					});
				} else {
					$(this).children('span').attr('class', 'ion-android-favorite-outline');
					$.getJSON(url, {
						'agree': '-1',
						'csrfmiddlewaretoken': '{{ csrf_token }}'
					}).done(function (data) {
						that.children('span').text(' 喜欢 ' + data);
					});
				}
			})
		</script>
	</body>
</html>
